<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Tableau de Commande Interactif</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
    <script>
        // Définition des données des produits
        // Définition des données des produits
</script>
<script src="produits_script.js"></script><script>
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles CSS personnalisés pour améliorer l'apparence */
        .produit-nom {
            font-weight: 600;
        }

        .prix, .volume, .poids, .nombre-colis, .conditionnement {
            font-weight: 400;
        }

        .quantite {
            width: 80px;
            text-align: center;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            font-size: 1rem;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.06);
            color: #4b5563;
        }

        .quantite:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .total-ligne {
            font-weight: 700;
            font-size: 1.25rem;
        }

        .prix-total, .volume-total, .poids-total {
            font-weight: 600;
            text-align: right;
        }

        .image-produit {
            max-width: 100px;
            height: auto;
            border-radius: 0.375rem;
            margin-right: 0.5rem;
        }

        /* Style pour la barre de défilement */
        .scrollable-table {
            max-height: 50vh;
            overflow-y: auto;
            overflow-y: auto;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .scrollable-table::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-table::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 0.5rem;
        }

        .scrollable-table::-webkit-scrollbar-thumb {
            background-color: #a0aec0;
            border-radius: 0.5rem;
            border: 2px solid #f1f3f5;
        }

        .scrollable-table::-webkit-scrollbar-thumb:hover {
            background-color: #718096;
        }

        .nombre-colis-input {
            width: 80px;
            text-align: center;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            font-size: 1rem;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.06);
        }

        .nombre-colis-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        #email-input {
            width: 250px;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            font-size: 1rem;
            margin-right: 1rem;
            color: #000;
        }

        #email-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        #devis-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #devis-button:hover {
            background-color: #2563eb;
        }

        .container {
            /* Dégradé linéaire sur le conteneur principal */
            background: linear-gradient(90deg, #5de0e6, #004aad, #004aad);
        }

        .blue-header {
            color: #ffffff;
        }

        .bg-blue-header {
            background-color: #3b82f6;
        }

        /* Couleurs pour les lignes alternées */
        .bg-light-blue {
            background-color: #e0f7fa;
        }

        .bg-lighter-blue {
            background-color: #b2ebf2;
        }

        /* Styles pour le pop-up */
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 90%; /* Ensure it doesn't overflow on smaller screens */
            max-height: 90%;
            overflow: auto; /* Enable scrolling if the content is too large */
            position: relative; /* Ajout de position relative pour positionner le bouton */
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 1.5em;
            color: black; /* Changement de couleur ici */
        }

        .popup-img {
            max-width: 100%; /* Make image responsive */
            height: auto;
            border-radius: 5px; /* Optional: Add rounded corners to the image */
            margin-bottom: 20px; /* Add some space below the image */
        }

        .close-button-below {
            margin-top: 10px; /* Add space above the button */
            text-align: center; /* Center the button */
        }

        .view-image-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #3b82f6;
            color: #fff;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
        }

        .view-image-button:hover {
            background-color: #2563eb;
        }

        .close-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #3b82f6;
            color: #fff;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
        }

        .close-button:hover {
            background-color: #2563eb;
        }

        tfoot {
            position: sticky;
            bottom: 0;
            background-color: #f7fafc;
            box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1);
        }

        .elevated-container {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .elevated-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }


        .scrollable-wrapper {
            display: flex;
            overflow-x: auto;
            max-width: 100%;
        }

        .scrollable-left {
            flex: 0 0 auto;
            min-width: 1300px; /* Colonnes jusqu'à 'Colis par palette' */
        }

        .scrollable-right {
            flex: 0 0 auto;
            min-width: 600px;
            overflow-x: auto;
        }

        .scrollable-right th,
        .scrollable-right td {
            min-width: 180px;
        }

        .scrollable-table {
            max-height: 50vh;
            overflow-y: auto;
        }


        th, td {
            padding-left: 4px !important;
            padding-right: 4px !important;
            padding-top: 4px !important;
            padding-bottom: 4px !important;
            font-size: 0.75rem !important;
            white-space: nowrap;
        }

        th, td {
            text-align: center !important;
            vertical-align: middle !important;
        }

        th, td {
            padding-left: 2px !important;
            padding-right: 2px !important;
            padding-top: 3px !important;
            padding-bottom: 3px !important;
            font-size: 0.65rem !important;
        }

        th, td {
            padding-left: 1px !important;
            padding-right: 1px !important;
            padding-top: 2px !important;
            padding-bottom: 2px !important;
            font-size: 0.55rem !important;
        }

        tfoot tr {
            background-color: #1e40af !important;
            color: #ffffff !important;
            font-size: 1rem !important;
            font-weight: 700 !important;
            padding: 10px !important;
        }

        tfoot td {
            padding: 12px !important;
            font-size: 1rem !important;
        }

        th, td {
            border-right: 1px solid #3b82f6 !important;
        }

        th:last-child, td:last-child {
            border-right: none !important;
        }

        th, td {
            border-right: 1px solid #dbeafe !important; /* bleu très clair */
        }

        th:last-child, td:last-child {
            border-right: none !important;
        }

        .prix, .volume, .poids {
            color: #000000 !important;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #3b82f6;
        }


        .popup {
            z-index: 9999 !important;
        }

        .popup-content {
            z-index: 10000 !important;
        }
    </style>
</head>
<body class="font-sans antialiased">
<div class="container mx-auto p-6 rounded-lg shadow-md mt-10 elevated-container">
    <h1 class="text-2xl font-semibold text-white mb-8 text-center">Composez votre commande</h1>
    <div class="mb-4">
        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
               id="produit-filter" placeholder="Rechercher par produit" type="text"/>
        <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-2"
                id="famille-select">
            <option value="">Toutes les familles</option>
        </select>
    </div>
    <div class="rounded-md overflow-hidden shadow-sm">
        <div class="scrollable-table">
            <table class="min-w-full divide-y divide-gray-200" id="product-table">
                <thead class="bg-blue-header">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        N/Code
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Désignation
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Famille produits
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Image
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Conditionnement
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Nombre de colis
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Prix
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Poids unitaire
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Volume unitaire
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Quantités
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Colis par palette
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Poids total (kg)
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Volume total
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium blue-header uppercase tracking-wider"
                        scope="col">
                        Prix total
                    </th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                </tbody>
                <tfoot class="bg-gray-50 total-row-fixed">
                <tr style="background-color: #1e40af; color: #ffffff;">
                    <td class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider total-ligne">
                        Total
                    </td>
                    <td class="px-6 py-3 text-center text-xl font-bold total-ligne" colspan="13">
                        <div style="display: flex; justify-content: space-around;">
                            <div id="total-colis" style="color: #ffffff; font-weight: bold;">Nombre de colis : <span
                                    style="color: #ffffff; font-weight: normal;">0</span></div>
                            <div id="total-poids" style="color: #ffffff; font-weight: bold;">Poids total : <span
                                    style="color: #ffffff; font-weight: normal;">0.00 kg</span></div>
                            <div id="total-volume" style="color: #ffffff; font-weight: bold;">Volume total : <span
                                    style="color: #ffffff; font-weight: normal;">0.00 m³</span></div>
                            <div id="total-prix" style="color: #ffffff; font-weight: bold;">Prix total : <span
                                    style="color: #ffffff; font-weight: normal;">0.00 €</span></div>
                        </div>
                    </td>
                </tr>
                </tfoot>
            </table>
        </div>
        <div class="mt-8 flex justify-center items-center">
            <input id="email-input" placeholder="Entrez votre adresse email" style="color: #000;" type="email"/>
            <button id="devis-button">RECEVOIR MON DEVIS</button>
        </div>
    </div>
</div>
<div class="popup" id="imagePopup">
    <div class="popup-content">
        <img alt="Image en grand" class="popup-img" id="popupImage" src=""/>
        <div class="close-button-below">
            <button class="close-button" onclick="hideImage()">Fermer</button>
        </div>
    </div>
</div>
<script>
    let quantitesParProduit = {};

    function sauvegarderQuantites() {
        const lignes = document.querySelectorAll('tbody tr');
        lignes.forEach(ligne => {
            const code = ligne.querySelector('td:nth-child(1)').textContent.trim();
            const input = ligne.querySelector('.nombre-colis-input');
            if (code && input) {
                quantitesParProduit[code] = input.value;
            }
        });
    }

    function restaurerQuantites() {
        const lignes = document.querySelectorAll('tbody tr');
        lignes.forEach(ligne => {
            const code = ligne.querySelector('td:nth-child(1)').textContent.trim();
            const input = ligne.querySelector('.nombre-colis-input');
            if (code in quantitesParProduit && input) {
                input.value = quantitesParProduit[code];
            }
        });
    }

    document.getElementById('produit-filter').addEventListener('input', sauvegarderQuantites);
    document.getElementById('famille-select').addEventListener('change', sauvegarderQuantites);
</script>
<script>
    function recalculerTotalGlobal() {
        let totalPrix = 0;
        let totalVolume = 0;
        let totalPoids = 0;
        let totalColis = 0;

        Object.keys(quantitesParProduit).forEach(code => {
            const produit = produits.find(p => p.code === code);
            const nombreColis = parseInt(quantitesParProduit[code]) || 0;
            const prixUnitaire = parseFloat(produit.prix) || 0;
            const volumeUnitaire = parseFloat(produit.volume) || 0;
            const poidsUnitaire = parseFloat(produit.poids) || 0;
            const conditionnement = parseInt(produit.conditionnement) || 1;

            const quantite = nombreColis * conditionnement;
            const prixTotal = prixUnitaire * quantite;
            const volumeTotal = volumeUnitaire * nombreColis;
            const poidsTotal = poidsUnitaire * nombreColis;

            totalPrix += prixTotal;
            totalVolume += volumeTotal;
            totalPoids += poidsTotal;
            totalColis += nombreColis;
        });

        document.getElementById('total-prix').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Prix total : </span><span style="color: #ffffff; font-weight: normal;">' + totalPrix.toFixed(2) + " €</span>";
        document.getElementById('total-volume').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Volume total : </span><span style="color: #ffffff; font-weight: normal;">' + totalVolume.toFixed(2) + " m³</span>";
        document.getElementById('total-poids').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Poids total : </span><span style="color: #ffffff; font-weight: normal;">' + totalPoids.toFixed(2) + " kg</span>";
        document.getElementById('total-colis').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Nombre de colis : </span><span style="color: #ffffff; font-weight: normal;">' + totalColis + '</span>';
    }
</script>
<script>
    function mettreAJourTotauxParLigne() {
        const lignes = document.querySelectorAll('tbody tr');
        lignes.forEach(ligne => {
            const input = ligne.querySelector('.nombre-colis-input');
            const nombreColis = parseInt(input.value) || 0;

            const conditionnement = parseInt(ligne.querySelector('.conditionnement').textContent) || 1;
            const prix = parseFloat(ligne.querySelector('.prix').textContent.replace(' €', '')) || 0;
            const poids = parseFloat(ligne.querySelector('.poids').textContent.replace(' kg', '')) || 0;
            const volume = parseFloat(ligne.querySelector('.volume').textContent.replace(' m³', '')) || 0;

            const quantite = nombreColis * conditionnement;
            ligne.querySelector('.quantite').textContent = quantite;
            ligne.querySelector('.poids-total').textContent = (poids * nombreColis).toFixed(2) + " kg";
            ligne.querySelector('.volume-total').textContent = (volume * nombreColis).toFixed(2) + " m³";
            ligne.querySelector('.prix-total').textContent = (prix * quantite).toFixed(2) + " €";
        });
    }
</script>
<script>

    function recalculerTotal() {
        let totalPrix = 0;
        let totalVolume = 0;
        let totalPoids = 0;
        let totalColis = 0;

        const lignes = document.querySelectorAll('tbody tr');
        lignes.forEach(ligne => {
            const nombreColisInput = ligne.querySelector('.nombre-colis-input');
            const nombreColis = parseInt(nombreColisInput.value) || 0;
            const prixUnitaire = parseFloat(ligne.querySelector('.prix').textContent.replace(' €', '')) || 0;
            const volumeUnitaire = parseFloat(ligne.querySelector('.volume').textContent.replace(' m³', '')) || 0;
            const poidsUnitaire = parseFloat(ligne.querySelector('.poids').textContent.replace(' kg', '')) || 0;
            const conditionnement = parseInt(ligne.querySelector('.conditionnement').textContent) || 1;
            const prixTotalCell = ligne.querySelector('.prix-total');
            const volumeTotalCell = ligne.querySelector('.volume-total');
            const poidsTotalCell = ligne.querySelector('.poids-total');
            const quantiteCell = ligne.querySelector('.quantite');

            const quantite = nombreColis * conditionnement;
            quantiteCell.textContent = quantite;

            const prixTotal = prixUnitaire * quantite;
            const volumeTotal = volumeUnitaire * nombreColis;
            const poidsTotal = poidsUnitaire * nombreColis;

            prixTotalCell.textContent = prixTotal.toFixed(2) + " €";
            volumeTotalCell.textContent = volumeTotal.toFixed(2) + " m³";
            poidsTotalCell.textContent = poidsTotal.toFixed(2) + " kg";
            totalColis += nombreColis;

            totalPrix += prixTotal;
            totalVolume += volumeTotal;
            totalPoids += poidsTotal;
        });

        document.getElementById('total-prix').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Prix total : </span><span style="color: #ffffff; font-weight: normal;">' + totalPrix.toFixed(2) + " €</span>";
        document.getElementById('total-volume').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Volume total : </span><span style="color: #ffffff; font-weight: normal;">' + totalVolume.toFixed(2) + " m³</span>";
        document.getElementById('total-poids').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Poids total : </span><span style="color: #ffffff; font-weight: normal;">' + totalPoids.toFixed(2) + " kg</span>";
        document.getElementById('total-colis').innerHTML = '<span style="color: #ffffff; font-weight: bold;">Nombre de colis : </span><span style="color: #ffffff; font-weight: normal;">' + totalColis + '</span>';
    }


    document.getElementById('devis-button').addEventListener('click', function () {
        const emailInput = document.getElementById('email-input').value;
        if (emailInput) {
            // URL du serveur pour recevoir les données
            const serverUrl = 'https://formspree.io/f/meoggobn';  // Remplacez par l'URL de votre serveur

            // Construction de l'objet de données à envoyer
            const orderData = {
                email: emailInput,
                order: []
            };

            let totalPrix = 0;
            let totalVolume = 0;
            let totalPoids = 0;

            const lignes = document.querySelectorAll('tbody tr');
            lignes.forEach(ligne => {
                const nombreColis = parseInt(ligne.querySelector('.nombre-colis-input').value) || 0;
                if (nombreColis > 0) {
                    const code = ligne.querySelector('td:nth-child(1)').textContent.trim();
                    const designation = ligne.querySelector('.produit-nom').textContent.trim();
                    const familleProduit = ligne.querySelector('td:nth-child(3)').textContent.trim();
                    const conditionnement = ligne.querySelector('td:nth-child(5)').textContent.trim();
                    const prixUnitaire = parseFloat(ligne.querySelector('.prix').textContent.replace(' €', '')) || 0;
                    const poidsUnitaire = parseFloat(ligne.querySelector('.poids').textContent.replace(' kg', '')) || 0;
                    const volumeUnitaire = parseFloat(ligne.querySelector('.volume').textContent.replace(' m³', '')) || 0;
                    const colisParPalette = ligne.querySelector('td:nth-child(11)').textContent.trim();
                    const quantite = nombreColis * parseInt(conditionnement);
                    const poidsTotalLigne = poidsUnitaire * nombreColis;
                    const volumeTotalLigne = volumeUnitaire * nombreColis;
                    const prixTotalLigne = prixUnitaire * quantite;

                    orderData.order.push({
                        code: code,
                        designation: designation,
                        famille: familleProduit,
                        conditionnement: conditionnement,
                        quantité: quantite,
                        prix: prixUnitaire.toFixed(2),
                        poidsParColis: poidsUnitaire.toFixed(2),
                        poidsTotal: poidsTotalLigne.toFixed(2),
                        volume: volumeUnitaire.toFixed(2),
                        colisParPalette: colisParPalette,
                        total: prixTotalLigne.toFixed(2)
                    });

                    totalPrix += prixTotalLigne;
                    totalVolume += volumeTotalLigne;
                    totalPoids += poidsTotalLigne;
                }
            });

            orderData.totalPrice = totalPrix.toFixed(2);
            orderData.totalVolume = totalVolume.toFixed(2);
            orderData.totalWeight = totalPoids.toFixed(2);

            // Envoi des données au serveur
            const orderText = JSON.stringify(orderData, null, 2);

            fetch(serverUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': ''application/json'',  // Envoyer les données comme texte brut
                    'Accept': 'text/plain'       // Accepter une réponse en texte brut
                },
                body:  orderText
            })
                .then(response => {
                    if (response.ok) {
                        alert('Devis envoyé avec succès !');
                        // Réinitialisation du formulaire
                        document.getElementById('email-input').value = '';
                        const nombreColisInputs = document.querySelectorAll('.nombre-colis-input');
                        nombreColisInputs.forEach(input => {
                            input.value = '0';
                        });
                        quantitesParProduit = {};
                        recalculerTotal();
                        mettreAJourTotauxParLigne();
                    } else {
                        alert('Erreur lors de l\'envoi du devis.');
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    alert('Erreur lors de l\'envoi du devis : ' + error.message);
                });
        } else {
            alert('Veuillez entrer votre adresse email.');
        }
    });

    function showImage(imageUrl) {
        const popup = document.getElementById("imagePopup");
        const popupImg = document.getElementById("popupImage");
        popupImg.src = imageUrl;
        popup.style.display = "flex";
    }

    function hideImage() {
        const popup = document.getElementById("imagePopup");
        popup.style.display = "none";
    }

    const produitFilterInput = document.getElementById('produit-filter');
    const familleSelect = document.getElementById('famille-select');
    const productTable = document.getElementById('product-table');


    let familles = [];
    produits.forEach(produit => {
        if (!familles.includes(produit.famille)) {
            familles.push(produit.famille);
        }
    });

    familles.forEach(famille => {
        const option = document.createElement('option');
        option.value = famille.toLowerCase();
        option.textContent = famille;
        familleSelect.appendChild(option);
    });


    function afficherProduits(filteredProduits) {
        const tableBody = productTable.querySelector('tbody');
        tableBody.innerHTML = '';
        let rowCount = 0;
        filteredProduits.forEach((produit, index) => {
            const row = document.createElement('tr');
            row.className = rowCount % 2 === 0 ? 'bg-light-blue' : 'bg-lighter-blue';
            rowCount++;

            // Utilisez un attribut data- pour stocker l'URL de l'image
            const imageButton = `<button class="view-image-button" data-image-url="${produit.image}">Voir</button>`;

            row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${produit.code}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 produit-nom">
                        ${produit.designation}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 famille-produit">
                        ${produit.famille}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${imageButton}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 conditionnement">
                        ${produit.conditionnement}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 nombre-colis">
                        <input type="number" value="0" min="0" class="nombre-colis-input" data-prix="${produit.prix}" data-volume="${produit.volume}" data-poids="${produit.poids}">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 prix">
                        ${produit.prix.toFixed(2)} €
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 poids">
                        ${produit.poids} kg
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 volume">
                        ${produit.volume.toFixed(2)} m³
                    </td>
                     <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 quantite">
                        0
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 colis-par-palette">
                        ${produit.colisParPalette}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 poids-total">
                        0.00 kg
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 volume-total">
                        0.00 m³
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 prix-total">
                        0.00 €
                    </td>
                `;
            tableBody.appendChild(row);
        });

        const nombreColisInputs= document.querySelectorAll('.nombre-colis-input');
        nombreColisInputs.forEach(input => {
            input.addEventListener('change', function () {            const code = this.closest('tr').querySelector('td:nth-child(1)').textContent.trim();            quantitesParProduit[code] = this.value;            mettreAJourTotauxParLigne();
                recalculerTotalGlobal();
            });
        });

        // Attachez l'événement onclick à chaque bouton "Voir"
        const viewImageButtons = document.querySelectorAll('.view-image-button');
        viewImageButtons.forEach(button => {
            button.addEventListener('click', function () {
                const imageUrl = this.getAttribute('data-image-url');
                showImage(imageUrl);
            });
        });

        recalculerTotal();
    }


    produitFilterInput.addEventListener('input', () => {
        const produitFilterValue = produitFilterInput.value.toLowerCase();
        const familleFilterValue = familleSelect.value.toLowerCase();

        const filteredProduits = produits.filter(produit => {
            return produit.designation.toLowerCase().includes(produitFilterValue) &&
                (familleFilterValue === "" || produit.famille.toLowerCase() === familleFilterValue);
        });
        afficherProduits(filteredProduits);
        restaurerQuantites();
        mettreAJourTotauxParLigne();
        recalculerTotalGlobal();
    });

    familleSelect.addEventListener('change', () => {
        const produitFilterValue = produitFilterInput.value.toLowerCase();
        const familleFilterValue = familleSelect.value.toLowerCase();

        const filteredProduits = produits.filter(produit => {
            return produit.designation.toLowerCase().includes(produitFilterValue) &&
                (familleFilterValue === "" || produit.famille.toLowerCase() === familleFilterValue);
        });
        afficherProduits(filteredProduits);
        restaurerQuantites();
        mettreAJourTotauxParLigne();
        recalculerTotalGlobal();
    });

    afficherProduits(produits);


    function showImage(imageUrl) {
        const popup = document.getElementById("imagePopup");
        const popupImg = document.getElementById("popupImage");
        popupImg.src = imageUrl;
        popup.style.display = "flex";
    }

    function hideImage() {
        const popup = document.getElementById("imagePopup");
        popup.style.display = "none";
    }
</script>




<script>
    let indexDebut = 0;
    const tailleBatch = 25;

    function afficherProduitsParLot(produits) {
        const tableBody = document.querySelector('#product-table tbody');
        let rowCount = tableBody.querySelectorAll('tr').length;

        const produitsRestants = produits.slice(indexDebut, indexDebut + tailleBatch);
        produitsRestants.forEach((produit, index) => {
            const row = document.createElement('tr');
            row.className = rowCount % 2 === 0 ? 'bg-light-blue' : 'bg-lighter-blue';
            rowCount++;

            const imageButton = `<button class="view-image-button" data-image-url="${produit.image}">Voir</button>`;

            row.innerHTML = `
                <td>${produit.code}</td>
                <td class="produit-nom">${produit.designation}</td>
                <td>${produit.famille}</td>
                <td>${imageButton}</td>
                <td class="conditionnement">${produit.conditionnement}</td>
                <td><input type="number" value="0" min="0" class="nombre-colis-input" data-prix="${produit.prix}" data-volume="${produit.volume}" data-poids="${produit.poids}"></td>
                <td class="prix">${produit.prix.toFixed(2)} €</td>
                <td class="poids">${produit.poids} kg</td>
                <td class="volume">${produit.volume.toFixed(2)} m³</td>
                <td class="quantite">0</td>
                <td>${produit.colisParPalette}</td>
                <td class="poids-total">0.00 kg</td>
                <td class="volume-total">0.00 m³</td>
                <td class="prix-total">0.00 €</td>
            `;
            tableBody.appendChild(row);
        });

        const inputs = document.querySelectorAll('.nombre-colis-input');
        inputs.forEach(input => {
            input.addEventListener('change', function () {
                const code = this.closest('tr').querySelector('td:nth-child(1)').textContent.trim();
                quantitesParProduit[code] = this.value;
                mettreAJourTotauxParLigne();
                recalculerTotalGlobal();
            });
        });

        const buttons = document.querySelectorAll('.view-image-button');
        buttons.forEach(button => {
            button.addEventListener('click', function () {
                const imageUrl = this.getAttribute('data-image-url');
                showImage(imageUrl);
            });
        });

        indexDebut += tailleBatch;
    }

    window.addEventListener('scroll', () => {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 50) {
            afficherProduitsParLot(produits);
        }
    });

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
        afficherProduitsParLot(produits);
    });
</script>

</body>
</html>
